<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments :: head(~{::title})}">
  <title>Qu·∫£n l√Ω ƒê∆°n h√†ng</title>
</head>
<body>
<div class="d-flex" id="wrapper">
  <div th:replace="~{admin/fragments :: sidebar}"></div>
  <div id="page-content-wrapper">
    <div th:replace="~{admin/fragments :: top-nav}"></div>

    <div class="container-fluid px-4 mt-4">
      <h2 class="mb-4">üìù ƒê∆°n ƒë·∫∑t Tour</h2>
      <div class="card shadow-sm">
        <div class="card-header bg-white py-3">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h5 class="mb-0 text-primary fw-bold"><i class="bi bi-list-check"></i> Danh s√°ch ƒë∆°n h√†ng</h5>
            </div>
            <div class="col-md-6">
              <form action="/admin/bookings" method="get" class="d-flex justify-content-end">
                <div class="input-group" style="max-width: 300px;">
                  <span class="input-group-text bg-light"><i class="bi bi-search"></i></span>

                  <input type="text" name="search" class="form-control"
                         th:value="${searchCode}"
                         placeholder="Nh·∫≠p m√£ ƒë∆°n...">

                  <button class="btn btn-primary" type="submit">T√¨m</button>

                  <a th:if="${searchCode != null && searchCode != ''}" href="/admin/bookings" class="btn btn-secondary">
                    <i class="bi bi-x-lg"></i>
                  </a>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="card-body p-0">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-dark">
            <tr>
              <th>M√£ ƒë∆°n</th>
              <th>Kh√°ch ƒë·∫∑t</th>
              <th>Th√¥ng tin Tour</th>
              <th>Thanh to√°n</th> <th>Tr·∫°ng th√°i</th>
              <th>Thao t√°c</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(bookings)}">
              <td colspan="6" class="text-center py-4 text-muted">
                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o kh·ªõp v·ªõi y√™u c·∫ßu.
              </td>
            </tr>

            <tr th:each="b : ${bookings}">
              <td><span class="badge bg-secondary" th:text="${b.bookingCode}"></span></td>
              <td>
                <div class="fw-bold" th:text="${b.user != null ? b.user.fullName : 'Kh√°ch v√£ng lai'}"></div>
                <small class="text-muted" th:text="${b.user != null ? b.user.phone : ''}"></small>
              </td>
              <td>
                <div class="fw-bold text-primary" th:text="${b.schedule.tour.name}"></div>
                <small class="text-muted">
                  Kh·ªüi h√†nh: <span th:text="${#temporals.format(b.schedule.startDate, 'dd/MM/yyyy')}"></span>
                </small>
                <br>
                <small>
                  <i class="bi bi-people-fill"></i> <span th:text="${b.passengers.size()}"></span> kh√°ch
                </small>
              </td>
              <td>
                <div class="fw-bold text-danger" th:text="${#numbers.formatDecimal(b.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></div>
                <div class="mt-1">
                    <span th:if="${b.paymentMethod == 'MOMO'}" class="badge bg-danger border border-light">
                        <i class="bi bi-wallet2"></i> MoMo
                    </span>
                  <span th:if="${b.paymentMethod == 'VNPAY'}" class="badge bg-primary border border-light">
                        <i class="bi bi-credit-card"></i> VNPay
                    </span>
                  <span th:if="${b.paymentMethod == 'BANK_TRANSFER'}" class="badge bg-info text-dark border border-light">
                        <i class="bi bi-qr-code"></i> Chuy·ªÉn kho·∫£n
                    </span>
                  <span th:if="${b.paymentMethod == 'CASH'}" class="badge bg-success border border-light">
                        <i class="bi bi-cash-stack"></i> Ti·ªÅn m·∫∑t
                    </span>
                </div>
              </td>
              <td>
                <span th:if="${b.status.name() == 'PENDING'}" class="badge bg-warning text-dark">
                    <i class="bi bi-hourglass-split"></i> Ch·ªù TT
                </span>

                <span th:if="${b.status.name() == 'DEPOSITED'}" class="badge bg-info text-dark">
                    <i class="bi bi-cash-coin"></i> ƒê√£ c·ªçc
                </span>

                <span th:if="${b.status.name() == 'PAID'}" class="badge bg-success">
                    <i class="bi bi-check-circle-fill"></i> ƒê√£ thanh to√°n
                </span>

                <span th:if="${b.status.name() == 'CANCELLED'}" class="badge bg-danger">
                    <i class="bi bi-x-circle-fill"></i> ƒê√£ h·ªßy
                </span>
              </td>
              <td>
                <a th:href="@{'/admin/bookings/detail/' + ${b.id}}" class="btn btn-sm btn-info text-white">
                  <i class="bi bi-eye"></i> Chi ti·∫øt
                </a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<div th:replace="~{admin/fragments :: scripts}"></div>
</body>
</html>